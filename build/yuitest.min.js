var YUITest={TestCases:{},loadYUI:function(b,a){if(a){var c=b;b=function(d){window.$Y=d;c.apply(this)}}YUI().use("node","console","test",b)}};
YUITest.Configs={final_tally:"final_tally_result",global_logger:"#logger",global_logger_config:{height:"95%",newestOnTop:false,width:"500px"},pages:[],result_tpt:'<ul id="{id}"><li class="duration" data-value="{duration}">Duration: {duration} seconds</li><li class="ignored" data-value="{ignored}">Ignored Tests: {ignored}</li><li class="failed" data-value="{failed}">Failed Tests: {failed}</li><li class="passed" data-value="{passed}">Passed Tests: {passed}</li><li class="total" data-value="{total}">Total Tests: {total}</li></ul>',test_cases_selector:"#test_cases",
testee_id_tpt:"testee_{counter}",testee_type:"window",testee_window_name:"yuitest_testee",tester_logger:"#logger",tester_logger_config:{height:"500px",newestOnTop:false,width:"95%",style:"inline"},tester_type:"window",tester_url_tpt:"{protocol}//{host}/tests/unit_test.php",tester_window_name:"yuitest_tester",$user_configs:null,load:function(){var b=YUITest.Configs,a=function(d){$Y.Object.each(d,function(e,f){b[f]=e})},c=function(d){d.$C&&d.$C.YUITest&&c(d.$C);d.YUITest&&d.YUITest.Configs.$user_configs&&
a(d.YUITest.Configs.$user_configs)};c(window);return b},set:function(b){var a=YUITest.Configs;a.$user_configs=b;return a}};
YUITest.TestSuite={$counter:0,$tally:{duration:0,ignored:0,failed:0,passed:0,total:0},$testee:null,initialize:function(){YUITest.loadYUI(function(){var b=YUITest.Configs;b.load();(new $Y.Console(b.global_logger_config)).render(b.global_logger);YUITest.TestSuite.runNextTestPage()},true)},logEvent:function(b){b.message.message.indexOf("Test suite")!==0&&$Y.log(b.message.message,b.message.category,YUITest.Configs.pages[YUITest.TestSuite.$counter-1])},recordResultsForPage:function(b,a){var c=YUITest.TestSuite,
d=YUITest.Configs,e=$Y.Lang.sub(d.testee_id_tpt,{counter:b});$Y.one("#"+e).append($Y.Lang.sub("<strong> Done.</strong><br />"+d.result_tpt,{id:e+"_result",duration:(a.duration/1E3).toFixed(2),ignored:a.ignored,failed:a.failed,passed:a.passed,total:a.total}));c.$tally.duration+=a.duration;c.$tally.ignored+=a.ignored;c.$tally.failed+=a.failed;c.$tally.passed+=a.passed;c.$tally.total+=a.total;$Y.log("Finished testing "+d.pages[b],"warn");return c},runNextTestPage:function(b){var a=YUITest.TestSuite,
c=YUITest.Configs,d=$Y.one(document.body);b&&a.recordResultsForPage(a.$counter-1,b);if(a.$counter<c.pages.length){b=c.pages[a.$counter];$Y.log("Begin testing "+b,"warn");d.append($Y.Lang.sub('<div id="'+c.testee_id_tpt+'">Running tests on {page}...</div>',{counter:a.$counter,page:b}));a.updateTestee($Y.Lang.sub("{protocol}//{host}{page}",{protocol:window.location.protocol,host:window.location.host,page:b}));++a.$counter}else{d.append($Y.Lang.sub("<hr />"+(a.$tally.failed?'<h3 style="color: red;">Aww, {failed} tests failed.</h3>':
'<h3 style="color: green;">Congrats! No failed tests!</h3>')+c.result_tpt,{id:c.final_tally,duration:(a.$tally.duration/1E3).toFixed(2),ignored:a.$tally.ignored,failed:a.$tally.failed,passed:a.$tally.passed,total:a.$tally.total}));a.$testee&&a.$testee.YUITest.Testee.$tester&&a.$testee.YUITest.Testee.$tester.close();a.$testee&&a.$testee.close();$Y.log("All tests completed","warn")}return a},updateTestee:function(b){var a=YUITest.TestSuite,c=YUITest.Configs;if(c.testee_type==="iframe"){var d="#"+c.testee_window_name,
e=$Y.one(d);if(!e){$Y.one(document.body).append($Y.Lang.sub('<iframe id="{id}" name="{id}" frameborder="0"></iframe>',{id:c.testee_window_name}));e=$Y.one(d).setStyles({width:"0",height:"0"})}e.set("src",b)}else a.$testee=window.open(b,c.testee_window_name);return a}};
YUITest.Testee={$tester:null,initialize:function(){YUITest.loadYUI(function(){var b=window==window.parent?window.opener:window.parent;if(b&&b.YUITest)window.$C=b;YUITest.Configs.load();YUITest.Testee.start()},true)},getTestCases:function(){var b=$Y.one(YUITest.Configs.test_cases_selector);return b?b.get("innerHTML").split(","):[]},start:function(){var b=YUITest.Testee,a=YUITest.Configs,c=$Y.Lang.sub(a.tester_url_tpt,{protocol:window.location.protocol,host:window.location.host});if(a.tester_type===
"iframe"){var d="#"+a.tester_window_name,e=$Y.one(d);if(!e){$Y.one(document.body).append($Y.Lang.sub('<iframe id="{id}" name="{id}"></iframe>',{id:a.tester_window_name}));e=$Y.one(d).setStyles({height:"400px",width:"100%"})}e.set("src",c)}else b.$tester=window.open(c,a.tester_window_name);return b}};
YUITest.Tester={initialize:function(){YUITest.loadYUI(function(){window.$C=window==window.parent?window.opener:window.parent;YUITest.Configs.load();YUITest.Tester.start()},true)},start:function(){var b=YUITest.Tester,a=YUITest.Configs;$Y.one(document.body);var c=$C.YUITest.Testee.getTestCases();$Y.Array.each(c,function(d){$Y.Test.Runner.add(new $Y.Test.Case(YUITest.TestCases[d]))});c=new $Y.Console(a.tester_logger_config);c.render(a.tester_logger);c.on("entry",function(d){$C.$C&&$C.$C.YUITest&&$C.$C.YUITest.TestSuite.logEvent(d)});
$Y.Test.Runner.subscribe($Y.Test.Runner.COMPLETE_EVENT,function(){$C.$C&&$C.$C.YUITest&&$C.$C.YUITest.TestSuite.runNextTestPage($Y.Test.Runner.getResults())});$Y.Test.Runner.run();return b}};
